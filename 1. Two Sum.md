## first step

- 辞書を使うと思った。
- `target`に対する各数字の差とその位置を辞書に保存する。
- `nums`を見て、ある数字が辞書のキーと等しいなら返す（同じ要素でなければ）。

```python
from collections import defaultdict


class Solution:
    def twoSum(self, nums: List[int], target: int) -> List[int]:
        complement_to_pos = defaultdict(int)

        for i in range(len(nums)):
            complement_to_pos[target - nums[i]] = i
        for i in range(len(nums)):
            if (nums[i] in complement_to_pos and
                i != complement_to_pos[nums[i]]
            ):
                return [i, complement_to_pos[nums[i]]]
        return None
```

## second step

- `defaultdict`は必要ない。
- 辞書のキーは補数にするよりも、単純に数字にした方が素直だと思う。
- `enumerate`関数により、添え字と要素を分けた。
- `target - num`の変数名をつけるのに悩んだ。`difference`、　`complement`か`rest`が選択肢にあった。

```python
class Solution:
    def twoSum(self, nums: List[int], target: int) -> List[int]:
        num_to_pos = {}
        
        for i, num in enumerate(nums):
            num_to_pos[num] = i
        for i, num in enumerate(nums):
            difference = target - num
            if difference in num_to_pos and i != num_to_pos[difference]:
                return [i, num_to_pos[difference]]
        return None
```

- defaultdictと通常の辞書の違いは、`__missing__`メソッドがあること。
- `__getitem__`（`object[key]`の実装)が呼び出された時に、キーがまだ存在しない場合発動する。
- 引数に初期値のタイプを指定できる。

## 振り返り

- `complement`の方が、リストの中にある「数」という印象が、`differencde`よりもある気がしてきた。
- `nums`をソートして、two pointersを利用して解く方法もある。
- 組み合わせが見つからなかった場合に返すものは`None`でいいのか。空のリストが返ってくるよりも、メッセージつきの`Exception`を投げた方が利用者にわかりやすい。組み合わせが複数ある場合は、そのうちのどれか1組が返されるから、例外処理にならない。
- 組み合わせが見つからなかったことを伝えればいいのでは。

## third step

- 配列の走査が1回になった。
- 同じ要素かどうか確認する必要がなくなる。

```python
class Solution:
    def twoSum(self, nums: List[int], target: int) -> List[int]:
        num_to_index = {}

        for i in range(len(nums)):
            complement = target - nums[i]
            if complement in num_to_index:
                return [i, num_to_index[complement]]
            num_to_index[nums[i]] = i
        raise ValueError("No two numbers can add up to target.")
```


## 調べたこと

- [defaultdict](https://docs.python.org/ja/3.13/library/collections.html#collections.defaultdict)
- [enumerate document](https://docs.python.org/ja/3.13/library/functions.html#enumerate)

- [組み込み例外](https://docs.python.org/ja/3.13/library/exceptions.html)
  
